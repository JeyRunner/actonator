# THIS FILE IS AUTOGENERATED, DO NOT EDIT! 
# File was generated from spec file: motorControllerCanProtocol.spec.yaml 
# Generated by command 'canSotCli genProtocolSpec -f motorControllerCanProtocol.spec.yaml -o motorControllerCanProtocol.def.yaml '


# autogenerated object_tree entries (these will be treated as they would be in object_tree) 
object_tree_predefined:
  cliTool:
    - access: r
      default: 0
      name: version
      type: uint8

global_defs:
  enums: # global defined enums can be used as datatypes in the object tree
    - MOTOR_OPERATION_MODE:
        DO_NOTHING: 0  # just read the encoder data, no torque is applied to the motor. This state is active by default, or when an error occurs.
        #ERROR: 1
        CONTROL_PD: 2
        CONFIGURATION_PROCESS: 3


    - REQUEST_MOTOR_OPERATION_MODE:
        DO_NOTING: 0  # just read the encoder data, no torque is applied to the motor.
        CONTROL_PD: 2
    - REQUEST_MOTOR_OPERATION_MODE_ERROR:
        MOTOR_NOT_CONFIGURED: 0


    - MOTOR_ENABLED:
        ENABLED: 0
        DISABLED: 1

    - MOTOR_CONFIG_DIRECTION:
        NORMAL: 0   # same as encoder
        INVERSE: 1  # inverse direction as the encoder

    #- MOTOR_CHANGE_STATE:
    #    DISABLE: 0
    #    ENABLE: 1
    #    START_CONFIGURATION_PROCESS: 2

    - BOOL:
        FALSE: 0
        TRUE: 1


object_tree:
  - settings: # nodes with sub-nodes do not have an own value
      - velocity_filter:
          - name: smoothingTf # name of the value (just has to be unique in the current tree branch)
            type: float32   # possible type value: uint8, ..., int8, ..., float16, ..., ENUM_NAME
            access: rw      # access rights for the master perspective,
                            #    possible values: 'r' for read, 'w' for write, 'rw' for read and write, 
                            #                     'only_sp' when this value can only be written or read by a stream packages
        # motor specific config
      - motor_parameters:   # set these via the remote call SetMotorParameters
          - name: encoderElectricalOffset
            type: int16
            access: r
          - name: electricalRotationsPerRevolution
            type: uint8
            access: r
          - name: motorDirection
            type: MOTOR_CONFIG_DIRECTION
            access: r
          - name: motorParametersValid
            doc: "Is true when all motor parameters have been set 
                  either by the MotorInitSequence or by calling SetMotorParameters."
            type: BOOL
            access: r


  # debug values
  - debug:
      - name: clientRxBufferNumPackages
        type: uint16
        access: r
      - name: clientTxBufferNumPackages
        type: uint16
        access: r

  - motor:
      - name: operationMode
        doc: "Which control mode is used for the motor. Can be changed by remote calls StartMotorTesting, "
        type: MOTOR_OPERATION_MODE
        access: r
        default: DO_NOTING

      - name: enabled
        doc: "Enable or disable the motor driving circuit. When disabled all phase voltages will be pulled to GND.
              When the motor enters an error state, this will be set to disabled.
              Switching to enabled can fail when the motor is not configured."
        type: MOTOR_ENABLED
        access: rw
        default: DISABLED

      - name: maxThrottle
        doc: "Max allowed torque value limit (1 is 100% of possible throttle).
              When the required torque (as output of the pd controller) is bigger than this value it will be cropped to this value."
        type: float32
        access: rw

        
      - current_values:
          - name: position
            type: float32
            access: r
          - name: velocity
            type: float32
            access: r
          - name: velocityNonFiltered
            type: float32
            access: r
          - torque: # value node can be also defined this way (name inline) as alternative to (name: torque)
              type: float32
              doc: "current torque/throttle value applied to the motor. 1 corresponds to full (100%) throttle."
              access: r

      - target_values_pd: # set these
          - name: position
            type: float32
            access: rw
          - name: velocity
            type: float32
            access: rw
          - name: gainP
            type: float32
            access: rw
          - name: gainD
            type: float32
            access: rw

      - name: temperature
        type: float32
        access: r
        doc: # optional doc
          unit: 'Â°C'
          min: 1


      - test_pd_mode:
          - name: active
            doc: "active test pd mode, this will use sin values of the targt pd position value.
                  Values send to target_values_pd.position will be ignored. "
            type: BOOL
            access: rw





# define all possible stream time packages, these can be also used to send events
stream_packages:



# remote calls are similar to stream_packages in the sense that multiple values are transferred at once.
# but remote calls do not change values in the object tree, but just transfer temporary values.
# The receiver side can check if a remote call has been made and retrieve the passed arguments.
# Later the receiver can return values on success, or return an error code (defined as an enum).
# The caller can then react to the returned values or error.
remote_calls:
  - name: StartMotorInitSequence
    doc: "This will turn the motor slowly to determine the motor direction and motorAlignmentOffset.
          On success these parameter will be set in the object tree."
    direction: master_to_client
    args:
      - name: throttle
        type: uint16
    return_values_ok:
      - name: motorAlignmentOffset
        type: float32
      - name: electricalRotationsPerRevolution
        type: uint8
      - name: motorDirection
        type: MOTOR_CONFIG_DIRECTION
        #return_value_error: START_MOTOR_TESTING_ERROR  # error return type (has to be an enum) (optional)

  - name: SetMotorParameters
    doc: "This overwrite the values in settings.motor_parameters and will "
    direction: master_to_client
    args:
      - name: encoderElectricalOffset
        type: int16
      - name: electricalRotationsPerRevolution
        type: uint8
      - name: motorDirection
        type: MOTOR_CONFIG_DIRECTION


  - name: ChangeMotorOperationMode
    direction: master_to_client
    args:
      - name: requestedOperationMode
        type: REQUEST_MOTOR_OPERATION_MODE
    return_value_error: REQUEST_MOTOR_OPERATION_MODE_ERROR






# autogenerated node value id mappings 
object_tree_node_ids:
  0: settings.velocity_filter.smoothingTf
  1: settings.motor_parameters.encoderElectricalOffset
  2: settings.motor_parameters.electricalRotationsPerRevolution
  3: settings.motor_parameters.motorDirection
  4: settings.motor_parameters.motorParametersValid
  5: debug.clientRxBufferNumPackages
  6: debug.clientTxBufferNumPackages
  7: motor.operationMode
  8: motor.enabled
  9: motor.maxThrottle
  10: motor.current_values.position
  11: motor.current_values.velocity
  12: motor.current_values.velocityNonFiltered
  13: motor.current_values.torque
  14: motor.target_values_pd.position
  15: motor.target_values_pd.velocity
  16: motor.target_values_pd.gainP
  17: motor.target_values_pd.gainD
  18: motor.temperature
  19: motor.test_pd_mode.active
  20: cliTool.version

# autogenerated remote_calls id mappings 
remote_calls_ids:
  0: StartMotorInitSequence
  1: SetMotorParameters
  2: ChangeMotorOperationMode
